<script>
  
</script>

<script>
  {% include "javascript/tabulator.min.js" %}

  let requested_data = '{{response_json}}'; //getting the data in json format from the lighttouch server
  let tableId = "#{{issue_table_id}}";

  class Issue {
        
    constructor(title,body,issue_url,created_date,labels){
      this.title = title;
      this.body = body;
      this.issue_url = issue_url;
      this.created_date = this.format_date(created_date);
      this.labels = labels; //an array of labels

    }
    
    format_date(date_string) {
      let d = new Date(date_string);
      
      return `${d.getUTCDay()}/${d.getUTCMonth()}/${d.getUTCFullYear()}`;
    }
  }   
  // function to open an url in a new tab
  function openURL(url) {
    window.open(url, '_blank');
  }

  requested_data = requested_data.replace(/&quot;/g,"\""); //replacing &quot; mark for " for javascript
  requested_data = requested_data.replace(/&#x2f;/g,"/"); //replacing &#x2f; mark for /  for urls 
  
  requested_data = JSON.parse(requested_data);

  // This considering is the github request

  let cleaned_data = requested_data.items.map(function(item) {
    let labels = " "
    try {
      labels = item.labels.map( el => el.name);
    } catch (error) {
      
    }

    return new Issue(
      item.title,
      item.body,
      item.html_url,
      item.created_at,
      labels,
    );
  });

  var table = new Tabulator(tableId, {
    data:cleaned_data,
    autoResize:true,
    pagination:"local", //enable local pagination.
    paginationSize:4,
    // responsiveLayout:true,
    columns:[
      { title: "Title" , field:"title" , sorter:"string" },
      { title: "Body" , field:"body" , sorter:"string" },
      { title: "Labels" , field:"labels" , sorter:"string" },
      { title: "Issue URL", field:"issue_url", sorter:"string"},
      { title: "Created at" , field:"created_date", sorter:"string" },
    ],
  });

</script>

